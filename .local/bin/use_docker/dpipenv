#!/bin/bash
#
# コマンド実行例: dpipenv -d -p 127.0.0.1:8888:8888 run python hoge.py
# dockerコマンドと同一のオプションが必要な場合の例: dpipenv -d run python hoge.py -- -d
#   単一の '-' または '--' の後に続いたコマンドは docker コマンドとしては処理されない。

PROGRAM_NAME=$(basename $0)

param_daemon=""
param_port=""
param=""
for OPT in "$@"
do
  case "$OPT" in
    "-p" | "--port")
      param_port="-p $2"
      shift 2
      ;;
    "-d" | "--daemon")
      param_daemon="-d"
      shift 1
      ;;
    "--" | "-")
      shift 1
      param="$param $@"
      break
      ;;
    *)
      if [[ -n "$1" ]] && [[ ! "$1" =~ ^-+ ]]; then
        param="$param $1"
        shift 1
      fi
      ;;
  esac
done

docker_run_with_mount_specific_dir \
  .git \
  $param_daemon \
  $param_port \
  iimuz/python-dev:v3.7.5-1 \
  pipenv $param
